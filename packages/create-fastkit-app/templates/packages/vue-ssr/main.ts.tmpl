import './styles/main.scss';

import viteSSR from 'vite-ssr';
import { createHead } from '@vueuse/head';
import { installVueStackPlugin } from '@/web/plugins/vue-stack';
import vueColorScheme from '@/<%~ it.package.dirName %>/plugins/color-scheme';
import { routes } from '@/<%~ it.package.dirName %>/routes';
import { App } from '@/<%~ it.package.dirName %>/App';

export default viteSSR(App, { routes }, (ctx) => {
  const { app, initialState } = ctx;
  const head = createHead();
  app.use(head);
  app.use(vueColorScheme);
  installVueStackPlugin(app);

  if (import.meta.env.SSR) {
    initialState.test = 'This should appear in page-view-source';
    // This object can be passed to Vuex store
  } else {
    // In browser, initialState will be hydrated with data from SSR
    console.log('Initial state:', initialState);
  }
  return { head };
});
