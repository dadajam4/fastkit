# @fastkit/vue-stack

ğŸŒ [English](https://github.com/dadajam4/fastkit/blob/main/packages/vue-stack/README.md) | æ—¥æœ¬èª

Vue.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãªã©ã®ã‚¹ã‚¿ãƒƒã‚¯å¯èƒ½ãªUIè¦ç´ ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚å‹•çš„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¡¨ç¤ºã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãªã©ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ç³»UIã«å¿…è¦ãªå…¨ã¦ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

## ç‰¹å¾´

- **çµ±åˆã‚¹ã‚¿ãƒƒã‚¯ç®¡ç†**: è¤‡æ•°ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä¸€å…ƒç®¡ç†
- **å‹•çš„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¡¨ç¤º**: ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèµ·å‹•
- **ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†**: è‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢æ©Ÿèƒ½
- **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ**: ESCã€Tabã€çŸ¢å°ã‚­ãƒ¼ãªã©ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰åˆ¶å¾¡
- **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ**: Vue Transitionã¨ã®å®Œå…¨çµ±åˆ
- **z-indexç®¡ç†**: è‡ªå‹•ã‚¹ã‚¿ãƒƒã‚¯é †åºåˆ¶å¾¡
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: ARIAå±æ€§ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ
- **ãƒ«ãƒ¼ã‚¿ãƒ¼çµ±åˆ**: Vue RouterãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒ¼ãƒ‰
- **ãƒœãƒ‡ã‚£ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡**: ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶é™
- **é…å»¶è¡¨ç¤º/éè¡¨ç¤º**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ™ãƒ¼ã‚¹ã®è‡ªå‹•åˆ¶å¾¡
- **Outside Clickæ¤œçŸ¥**: ã‚¹ã‚¿ãƒƒã‚¯å¤–ã‚¯ãƒªãƒƒã‚¯ç›£è¦–
- **æ°¸ç¶šåŒ–ãƒ¢ãƒ¼ãƒ‰**: å¼·åˆ¶çš„ãªè¡¨ç¤ºç¶­æŒæ©Ÿèƒ½

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install @fastkit/vue-stack
# or
pnpm add @fastkit/vue-stack

# ä¾å­˜é–¢ä¿‚
npm install vue vue-router
```

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š

```typescript
// main.ts
import { createApp } from 'vue';
import { createRouter, createWebHistory } from 'vue-router';
import { VueStackService } from '@fastkit/vue-stack';
import '@fastkit/vue-stack/vue-stack.css';

const app = createApp(App);

// ãƒ«ãƒ¼ã‚¿ãƒ¼è¨­å®š
const router = createRouter({
  history: createWebHistory(),
  routes: [/* ãƒ«ãƒ¼ãƒˆå®šç¾© */]
});

// ã‚¹ã‚¿ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹
const stackService = new VueStackService({
  zIndex: 32767,                    // ãƒ™ãƒ¼ã‚¹z-index
  snackbarDefaultPosition: 'top'    // ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä½ç½®
});

// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦æä¾›
app.provide(VueStackInjectionKey, stackService);

app.use(router);
app.mount('#app');
```

### åŸºæœ¬çš„ãªãƒ€ã‚¤ã‚¢ãƒ­ã‚°

```vue
<template>
  <div>
    <!-- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒˆãƒªã‚¬ãƒ¼ -->
    <button @click="showDialog">ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã</button>

    <!-- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -->
    <VDialog
      v-model="dialogVisible"
      transition="v-stack-slide-down"
      backdrop
      focus-trap
      close-on-esc
      close-on-outside-click
      @show="onDialogShow"
      @close="onDialogClose"
    >
      <div class="dialog">
        <h2>ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°</h2>
        <p>ã“ã®æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ</p>
        <div class="dialog-actions">
          <button @click="confirm">OK</button>
          <button @click="cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
      </div>
    </VDialog>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { VDialog, useVueStack } from '@fastkit/vue-stack';

const dialogVisible = ref(false);
const $vstack = useVueStack();

const showDialog = () => {
  dialogVisible.value = true;
};

const confirm = () => {
  console.log('ç¢ºèªã•ã‚Œã¾ã—ãŸ');
  dialogVisible.value = false;
};

const cancel = () => {
  console.log('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ');
  dialogVisible.value = false;
};

const onDialogShow = (control) => {
  console.log('ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ', control);
};

const onDialogClose = (control) => {
  console.log('ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã‚‰ã‚Œã¾ã—ãŸ', control);
  console.log('ã‚¯ãƒ­ãƒ¼ã‚ºç†ç”±:', control._.state.closeReason);
};
</script>
```

### ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚¿ãƒ¼ä»˜ããƒ¡ãƒ‹ãƒ¥ãƒ¼

```vue
<template>
  <VMenu
    open-on-hover
    :open-delay="500"
    :close-delay="200"
    transition="v-stack-fade"
  >
    <template #activator="{ attrs }">
      <button v-bind="attrs">
        ãƒ›ãƒãƒ¼ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º
      </button>
    </template>

    <div class="menu">
      <div class="menu-item">ã‚¢ã‚¤ãƒ†ãƒ 1</div>
      <div class="menu-item">ã‚¢ã‚¤ãƒ†ãƒ 2</div>
      <div class="menu-item">ã‚¢ã‚¤ãƒ†ãƒ 3</div>
    </div>
  </VMenu>
</template>

<script setup lang="ts">
import { VMenu } from '@fastkit/vue-stack';
</script>

<style scoped>
.menu {
  background: white;
  border: 1px solid #e1e5e9;
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  min-width: 150px;
}

.menu-item {
  padding: 8px 16px;
  cursor: pointer;
  border-bottom: 1px solid #f1f3f4;
}

.menu-item:hover {
  background: #f8f9fa;
}

.menu-item:last-child {
  border-bottom: none;
}
</style>
```

## åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### VDialog - ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

```vue
<template>
  <VDialog
    v-model="visible"
    backdrop
    focus-trap
    close-on-esc
    transition="v-stack-slide-down"
  >
    <div class="dialog-content">
      <h2>ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚¿ã‚¤ãƒˆãƒ«</h2>
      <p>ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å†…å®¹</p>
      <button @click="visible = false">é–‰ã˜ã‚‹</button>
    </div>
  </VDialog>
</template>
```

### VSnackbar - ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

```vue
<template>
  <VSnackbar
    v-model="showMessage"
    :timeout="3000"
    transition="v-stack-slide-up"
  >
    <div class="snackbar-content">
      {{ message }}
      <button @click="showMessage = false">Ã—</button>
    </div>
  </VSnackbar>
</template>
```

### VMenu - ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

```vue
<template>
  <VMenu open-on-click>
    <template #activator="{ attrs }">
      <button v-bind="attrs">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã</button>
    </template>

    <div class="menu-content">
      <div class="menu-item" @click="handleAction('action1')">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³1</div>
      <div class="menu-item" @click="handleAction('action2')">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³2</div>
    </div>
  </VMenu>
</template>
```

### VDynamicStacks - å‹•çš„ã‚¹ã‚¿ãƒƒã‚¯ç®¡ç†

ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ã«ã‚¹ã‚¿ãƒƒã‚¯è¦ç´ ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

```vue
<template>
  <div>
    <button @click="showProgrammaticDialog">ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°</button>
    <button @click="showSnackbar">ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼è¡¨ç¤º</button>
    <VDynamicStacks />
  </div>
</template>

<script setup lang="ts">
import { VDynamicStacks, useVueStack } from '@fastkit/vue-stack';

const $vstack = useVueStack();

const showProgrammaticDialog = async () => {
  try {
    const result = await $vstack.modal({
      component: 'VDialog',
      props: {
        backdrop: true,
        focusTrap: true,
        closeOnEsc: true,
      },
      slots: {
        default: () => h('div', { class: 'p-4' }, [
          h('h2', 'ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°'),
          h('p', 'ã“ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¯JavaScriptã‹ã‚‰è¡¨ç¤ºã•ã‚Œã¾ã—ãŸ'),
          h('button', {
            onClick: () => $vstack.resolve('confirmed'),
            class: 'btn btn-primary'
          }, 'ç¢ºèª')
        ])
      }
    });
    console.log('ãƒ€ã‚¤ã‚¢ãƒ­ã‚°çµæœ:', result);
  } catch (error) {
    console.log('ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ');
  }
};

const showSnackbar = () => {
  $vstack.snackbar({
    message: 'ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
    timeout: 3000,
    transition: 'v-stack-slide-up'
  });
};
</script>
```

## VStackControl API

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

```typescript
interface VStackControl {
  // çŠ¶æ…‹
  readonly isActive: boolean;              // è¡¨ç¤ºçŠ¶æ…‹
  readonly transitioning: boolean;         // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­
  readonly isResolved: boolean;           // è§£æ±ºæ¸ˆã¿
  readonly isCanceled: boolean;           // ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿
  readonly isDestroyed: boolean;          // ç ´æ£„æ¸ˆã¿

  // å€¤
  value: any;                             // å…¥åŠ›å€¤

  // è¨­å®š
  readonly timeout: number;               // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  readonly persistent: boolean;           // æ°¸ç¶šè¡¨ç¤º
  readonly zIndex: number;                // z-index
  readonly activateOrder: number;         // æ´»æ€§åŒ–é †åº

  // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒ»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰
  readonly focusRestorable: boolean;      // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªã‚¹ãƒˆã‚¢
  readonly closeOnEsc: boolean;           // ESCã§é–‰ã˜ã‚‹
  readonly closeOnTab: false | string;    // Tabã§é–‰ã˜ã‚‹
  readonly closeOnNavigation: boolean;    // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã§é–‰ã˜ã‚‹
  readonly closeOnOutsideClick: boolean;  // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹

  // é…å»¶
  readonly openDelay: number;             // è¡¨ç¤ºé…å»¶
  readonly closeDelay: number;            // éè¡¨ç¤ºé…å»¶

  // è¦ç´ å‚ç…§
  readonly contentRef: Ref<HTMLElement>;  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¦ç´ 
  readonly backdropRef: Ref<HTMLElement>; // ãƒãƒƒã‚¯ãƒ‰ãƒ­ãƒƒãƒ—è¦ç´ 
  readonly activator: HTMLElement;        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚¿ãƒ¼è¦ç´ 

  // ã‚¹ã‚¿ã‚¤ãƒ«
  readonly classes: any[];                // ã‚¯ãƒ©ã‚¹ä¸€è¦§
  readonly styles: StyleValue[];          // ã‚¹ã‚¿ã‚¤ãƒ«ä¸€è¦§

  // ãã®ä»–
  readonly $service: VueStackService;     // ã‚¹ã‚¿ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹
  readonly stackType?: string | symbol;   // ã‚¹ã‚¿ãƒƒã‚¯ã‚¿ã‚¤ãƒ—
  readonly disabled: boolean;             // ç„¡åŠ¹çŠ¶æ…‹
  readonly guardInProgress: boolean;      // ã‚¬ãƒ¼ãƒ‰å®Ÿè¡Œä¸­
}
```

### ãƒ¡ã‚½ãƒƒãƒ‰

```typescript
interface VStackControl {
  // è¡¨ç¤ºåˆ¶å¾¡
  show(): Promise<void>;                           // è¡¨ç¤º
  toggle(): Promise<void>;                         // è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
  close(opts?: VStackCloseOptions): Promise<void>; // éè¡¨ç¤º

  // è§£æ±ºãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«
  resolve(payload?: any): Promise<void | false>;   // è§£æ±º
  cancel(force?: boolean): Promise<void>;          // ã‚­ãƒ£ãƒ³ã‚»ãƒ«

  // è¨­å®š
  setActivator(query: VStackActivatorQuery): this; // ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚¿ãƒ¼è¨­å®š
  toFront(): void;                                 // æœ€å‰é¢ã¸
  resetValue(): void;                              // å€¤ãƒªã‚»ãƒƒãƒˆ

  // çŠ¶æ…‹ç¢ºèª
  isFront(filter?: Function): boolean;             // æœ€å‰é¢ã‹ç¢ºèª
  containsOrSameElement(el: Element): boolean;     // è¦ç´ åŒ…å«ç¢ºèª

  // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  render(fn: Function, opts?: object): VNode;      // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

  // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
  guardEffect(): void;                             // ã‚¬ãƒ¼ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå®Ÿè¡Œ
}
```

## VueStackService

### ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†

```typescript
import { VueStackService, useStack } from '@fastkit/vue-stack';

// ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ
const service = new VueStackService({
  zIndex: 32767,
  snackbarDefaultPosition: 'top'
});

// ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«ã§ã‚¢ã‚¯ã‚»ã‚¹
const stack = useStack();

// ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±
console.log(service.controls);          // å…¨ã‚¹ã‚¿ãƒƒã‚¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
console.log(service.zIndex);           // ãƒ™ãƒ¼ã‚¹z-index
console.log(service.dynamicSettings);  // å‹•çš„è¨­å®šä¸€è¦§

// ã‚¹ã‚¿ãƒƒã‚¯ç®¡ç†
const activeStacks = service.getActiveStacks();     // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚¿ãƒƒã‚¯å–å¾—
const frontStack = service.getFront();              // æœ€å‰é¢ã‚¹ã‚¿ãƒƒã‚¯å–å¾—
const isTransitioning = service.someTransitioning(); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã‹ç¢ºèª
```

### å‹•çš„ã‚¹ã‚¿ãƒƒã‚¯è¡¨ç¤º

```typescript
// å‹•çš„ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
const result = await service.dynamic(
  DialogComponent,
  {
    title: 'ç¢ºèª',
    message: 'ã“ã®æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ'
  },
  {
    default: () => h('p', 'ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„')
  }
);

if (result) {
  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¢ºèªã—ã¾ã—ãŸ:', result);
} else {
  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
}

// ãƒ©ãƒ³ãƒãƒ£ãƒ¼ä½œæˆ
const showConfirmDialog = service.createLauncher(
  ConfirmDialogComponent,
  (props) => ({
    ...props,
    variant: 'primary'
  })
);

// ãƒ©ãƒ³ãƒãƒ£ãƒ¼ä½¿ç”¨
const confirmed = await showConfirmDialog({
  title: 'å‰Šé™¤ç¢ºèª',
  message: 'ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ'
});
```

## é«˜åº¦ãªä½¿ç”¨ä¾‹

### ã‚«ã‚¹ã‚¿ãƒ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```vue
<!-- ConfirmDialog.vue -->
<template>
  <VDialog
    ref="stackRef"
    v-model="internalVisible"
    :transition="transition"
    backdrop
    focus-trap
    close-on-esc
    :persistent="loading"
    @show="onShow"
    @close="onClose"
  >
    <div class="confirm-dialog" :class="variantClass">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="dialog-header">
        <h3 class="dialog-title">{{ title }}</h3>
        <button
          v-if="!persistent && !loading"
          class="dialog-close"
          @click="cancel"
        >
          Ã—
        </button>
      </div>

      <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
      <div class="dialog-content">
        <p v-if="message" class="dialog-message">{{ message }}</p>
        <slot />
      </div>

      <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="dialog-actions">
        <button
          v-if="showCancel"
          class="dialog-button dialog-button--secondary"
          :disabled="loading"
          @click="cancel"
        >
          {{ cancelText }}
        </button>
        <button
          class="dialog-button dialog-button--primary"
          :class="variantClass"
          :disabled="loading"
          @click="confirm"
        >
          <span v-if="loading" class="loading-spinner"></span>
          {{ confirmText }}
        </button>
      </div>
    </div>
  </VDialog>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue';
import { VDialog, type VStackControl } from '@fastkit/vue-stack';

interface Props {
  modelValue?: boolean;
  title?: string;
  message?: string;
  confirmText?: string;
  cancelText?: string;
  variant?: 'primary' | 'danger' | 'warning';
  showCancel?: boolean;
  persistent?: boolean;
  transition?: string;
  beforeConfirm?: () => Promise<boolean> | boolean;
  beforeCancel?: () => Promise<boolean> | boolean;
}

const props = withDefaults(defineProps<Props>(), {
  modelValue: false,
  title: 'ç¢ºèª',
  confirmText: 'OK',
  cancelText: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
  variant: 'primary',
  showCancel: true,
  persistent: false,
  transition: 'v-stack-slide-down'
});

const emit = defineEmits<{
  'update:modelValue': [value: boolean];
  'confirm': [control: VStackControl];
  'cancel': [control: VStackControl];
}>();

const stackRef = ref<VStackControl>();
const internalVisible = ref(props.modelValue);
const loading = ref(false);

const variantClass = computed(() => `dialog--${props.variant}`);

// å¤–éƒ¨ã‹ã‚‰ã®è¡¨ç¤ºçŠ¶æ…‹åŒæœŸ
watch(() => props.modelValue, (newValue) => {
  internalVisible.value = newValue;
});

// å†…éƒ¨è¡¨ç¤ºçŠ¶æ…‹ã®å¤–éƒ¨åŒæœŸ
watch(internalVisible, (newValue) => {
  emit('update:modelValue', newValue);
});

const confirm = async () => {
  if (loading.value) return;

  loading.value = true;

  try {
    // beforeConfirmãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œ
    if (props.beforeConfirm) {
      const result = await props.beforeConfirm();
      if (result === false) {
        loading.value = false;
        return;
      }
    }

    const control = stackRef.value;
    if (control) {
      await control.resolve('confirmed');
      emit('confirm', control);
    }

    internalVisible.value = false;
  } catch (error) {
    console.error('ç¢ºèªå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
  } finally {
    loading.value = false;
  }
};

const cancel = async () => {
  if (loading.value) return;

  try {
    // beforeCancelãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œ
    if (props.beforeCancel) {
      const result = await props.beforeCancel();
      if (result === false) return;
    }

    const control = stackRef.value;
    if (control) {
      await control.cancel();
      emit('cancel', control);
    }

    internalVisible.value = false;
  } catch (error) {
    console.error('ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
  }
};

const onShow = (control: VStackControl) => {
  console.log('ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ');
};

const onClose = (control: VStackControl) => {
  console.log('ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã‚‰ã‚Œã¾ã—ãŸ');
  loading.value = false;
};
</script>

<style scoped>
.confirm-dialog {
  background: white;
  border-radius: 8px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  max-width: 500px;
  width: 90vw;
  max-height: 80vh;
  overflow: hidden;
}

.dialog-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px 16px;
  border-bottom: 1px solid #eee;
}

.dialog-title {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

.dialog-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  padding: 4px;
  line-height: 1;
}

.dialog-content {
  padding: 20px 24px;
}

.dialog-message {
  margin: 0;
  line-height: 1.5;
}

.dialog-actions {
  display: flex;
  gap: 12px;
  padding: 16px 24px 20px;
  justify-content: flex-end;
}

.dialog-button {
  padding: 8px 16px;
  border-radius: 4px;
  border: 1px solid;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  position: relative;
}

.dialog-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.dialog-button--secondary {
  background: white;
  color: #666;
  border-color: #ddd;
}

.dialog-button--primary {
  background: #1976d2;
  color: white;
  border-color: #1976d2;
}

.dialog-button--primary.dialog--danger {
  background: #d32f2f;
  border-color: #d32f2f;
}

.dialog-button--primary.dialog--warning {
  background: #f57c00;
  border-color: #f57c00;
}

.loading-spinner {
  display: inline-block;
  width: 14px;
  height: 14px;
  border: 2px solid currentColor;
  border-right-color: transparent;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-right: 8px;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
</style>
```

### ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```vue
<!-- ContextMenu.vue -->
<template>
  <VMenu
    ref="stackRef"
    v-model="internalVisible"
    :activator="activator"
    open-on-contextmenu
    close-on-outside-click
    close-on-esc
    transition="v-stack-scale"
    @show="onShow"
    @close="onClose"
  >
    <div class="context-menu" ref="menuRef">
      <div
        v-for="(item, index) in menuItems"
        :key="index"
        class="menu-item"
        :class="{
          'menu-item--disabled': item.disabled,
          'menu-item--separator': item.separator
        }"
        @click="handleItemClick(item)"
      >
        <div v-if="item.separator" class="menu-separator"></div>
        <template v-else>
          <span v-if="item.icon" class="menu-icon">{{ item.icon }}</span>
          <span class="menu-label">{{ item.label }}</span>
          <span v-if="item.shortcut" class="menu-shortcut">{{ item.shortcut }}</span>
        </template>
      </div>
    </div>
  </VMenu>
</template>

<script setup lang="ts">
import { ref, computed, nextTick } from 'vue';
import { VMenu, type VStackControl } from '@fastkit/vue-stack';

interface MenuItem {
  label?: string;
  icon?: string;
  shortcut?: string;
  disabled?: boolean;
  separator?: boolean;
  action?: () => void | Promise<void>;
}

interface Props {
  modelValue?: boolean;
  activator?: any;
  items: MenuItem[];
}

const props = defineProps<Props>();

const emit = defineEmits<{
  'update:modelValue': [value: boolean];
  'item-click': [item: MenuItem];
}>();

const stackRef = ref<VStackControl>();
const menuRef = ref<HTMLElement>();
const internalVisible = ref(props.modelValue || false);

const menuItems = computed(() => props.items);

const handleItemClick = async (item: MenuItem) => {
  if (item.disabled || item.separator) return;

  try {
    if (item.action) {
      await item.action();
    }
    emit('item-click', item);
  } catch (error) {
    console.error('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
  } finally {
    internalVisible.value = false;
  }
};

const onShow = async (control: VStackControl) => {
  await nextTick();

  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½ç½®èª¿æ•´
  if (menuRef.value) {
    const menu = menuRef.value;
    const rect = menu.getBoundingClientRect();
    const viewport = {
      width: window.innerWidth,
      height: window.innerHeight
    };

    // ç”»é¢å¤–ã«å‡ºã‚‹å ´åˆã®èª¿æ•´
    if (rect.right > viewport.width) {
      menu.style.left = `${viewport.width - rect.width - 10}px`;
    }

    if (rect.bottom > viewport.height) {
      menu.style.top = `${viewport.height - rect.height - 10}px`;
    }
  }
};

const onClose = (control: VStackControl) => {
  console.log('ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‰ã˜ã‚‰ã‚Œã¾ã—ãŸ');
};
</script>

<style scoped>
.context-menu {
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  min-width: 160px;
  max-width: 300px;
  padding: 4px 0;
  z-index: 1000;
}

.menu-item {
  display: flex;
  align-items: center;
  padding: 8px 16px;
  cursor: pointer;
  transition: background-color 0.15s;
  font-size: 14px;
}

.menu-item:hover:not(.menu-item--disabled):not(.menu-item--separator) {
  background-color: #f5f5f5;
}

.menu-item--disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.menu-item--separator {
  padding: 0;
  margin: 4px 0;
  cursor: default;
}

.menu-separator {
  height: 1px;
  background-color: #eee;
  margin: 0 8px;
}

.menu-icon {
  margin-right: 12px;
  width: 16px;
  text-align: center;
}

.menu-label {
  flex: 1;
}

.menu-shortcut {
  color: #999;
  font-size: 12px;
  margin-left: 16px;
}
</style>
```

### ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

```typescript
// snackbar.ts
import { VueStackService } from '@fastkit/vue-stack';
import SnackbarComponent from './SnackbarComponent.vue';

export interface SnackbarOptions {
  message: string;
  type?: 'info' | 'success' | 'warning' | 'error';
  duration?: number;
  position?: 'top' | 'bottom';
  action?: {
    label: string;
    handler: () => void;
  };
}

export function createSnackbarSystem(stackService: VueStackService) {
  const showSnackbar = (options: SnackbarOptions) => {
    const {
      message,
      type = 'info',
      duration = 4000,
      position = stackService.snackbarDefaultPosition,
      action
    } = options;

    return stackService.dynamic(
      SnackbarComponent,
      {
        message,
        type,
        duration,
        position,
        action
      }
    );
  };

  return {
    info: (message: string, options?: Partial<SnackbarOptions>) =>
      showSnackbar({ ...options, message, type: 'info' }),

    success: (message: string, options?: Partial<SnackbarOptions>) =>
      showSnackbar({ ...options, message, type: 'success' }),

    warning: (message: string, options?: Partial<SnackbarOptions>) =>
      showSnackbar({ ...options, message, type: 'warning' }),

    error: (message: string, options?: Partial<SnackbarOptions>) =>
      showSnackbar({ ...options, message, type: 'error' }),

    custom: showSnackbar
  };
}

// ä½¿ç”¨ä¾‹
const snackbar = createSnackbarSystem(stackService);

// å„ç¨®é€šçŸ¥
snackbar.info('æƒ…å ±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸');
snackbar.success('æ“ä½œãŒå®Œäº†ã—ã¾ã—ãŸ');
snackbar.warning('æ³¨æ„ãŒå¿…è¦ã§ã™');
snackbar.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä»˜ãé€šçŸ¥
snackbar.custom({
  message: 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ',
  type: 'info',
  duration: 5000,
  action: {
    label: 'å…ƒã«æˆ»ã™',
    handler: () => console.log('å…ƒã«æˆ»ã™å‡¦ç†')
  }
});
```

## ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### çµ„ã¿è¾¼ã¿ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³

```scss
/* ä½¿ç”¨å¯èƒ½ãªãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
.v-stack-fade-enter-active,
.v-stack-fade-leave-active {
  transition: opacity 0.3s ease;
}

.v-stack-fade-enter-from,
.v-stack-fade-leave-to {
  opacity: 0;
}

.v-stack-slide-down-enter-active,
.v-stack-slide-down-leave-active {
  transition: all 0.3s ease;
}

.v-stack-slide-down-enter-from {
  transform: translateY(-20px);
  opacity: 0;
}

.v-stack-slide-down-leave-to {
  transform: translateY(-20px);
  opacity: 0;
}

.v-stack-scale-enter-active,
.v-stack-scale-leave-active {
  transition: all 0.2s ease;
}

.v-stack-scale-enter-from,
.v-stack-scale-leave-to {
  transform: scale(0.8);
  opacity: 0;
}
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³

```vue
<template>
  <VDialog
    :transition="{
      transition: 'custom-slide',
      props: { duration: 500 }
    }"
  >
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  </VDialog>
</template>

<style>
.custom-slide-enter-active,
.custom-slide-leave-active {
  transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.custom-slide-enter-from {
  transform: translateX(-100%);
  opacity: 0;
}

.custom-slide-leave-to {
  transform: translateX(100%);
  opacity: 0;
}
</style>
```

## ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

### ARIAå±æ€§

```vue
<template>
  <VDialog
    v-model="dialogVisible"
    role="dialog"
    :aria-labelledby="titleId"
    :aria-describedby="descId"
    focus-trap
  >
    <div class="dialog">
      <h2 :id="titleId">{{ title }}</h2>
      <p :id="descId">{{ description }}</p>
      <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    </div>
  </VDialog>
</template>

<script setup lang="ts">
import { ref } from 'vue';

const titleId = 'dialog-title';
const descId = 'dialog-desc';
</script>
```

### ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®è¨­å®šä¾‹
const stackProps = {
  closeOnEsc: true,           // ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹
  closeOnTab: 'not-focused',  // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¤–ã§Tabã‚­ãƒ¼ã‚’æŠ¼ã™ã¨é–‰ã˜ã‚‹
  focusTrap: true,           // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—æœ‰åŠ¹
  focusRestorable: true      // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¾©å…ƒæœ‰åŠ¹
};
```

## ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```typescript
import { describe, test, expect, beforeEach } from 'vitest';
import { mount } from '@vue/test-utils';
import { VueStackService, VDialog } from '@fastkit/vue-stack';

describe('VueStack', () => {
  let stackService: VueStackService;

  beforeEach(() => {
    stackService = new VueStackService();
  });

  test('show and hide dialog', async () => {
    const wrapper = mount(VDialog, {
      props: {
        modelValue: false
      },
      global: {
        provide: {
          [VueStackInjectionKey]: stackService
        }
      }
    });

    expect(wrapper.vm.isActive).toBe(false);

    await wrapper.setProps({ modelValue: true });
    expect(wrapper.vm.isActive).toBe(true);
  });

  test('dynamic stack creation', async () => {
    const TestComponent = {
      template: '<div>Test Content</div>'
    };

    const promise = stackService.dynamic(TestComponent, 'Test Content');
    expect(stackService.dynamicSettings).toHaveLength(1);

    // Promise resolve
    const setting = stackService.dynamicSettings[0];
    setting.resolve('test-result');

    const result = await promise;
    expect(result).toBe('test-result');
  });
});
```

## ä¾å­˜é–¢ä¿‚

```json
{
  "dependencies": {
    "@fastkit/dom": "DOMæ“ä½œãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£",
    "@fastkit/helpers": "ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°",
    "@fastkit/tiny-logger": "è»½é‡ãƒ­ã‚°æ©Ÿèƒ½",
    "@fastkit/vue-body-scroll-lock": "ãƒœãƒ‡ã‚£ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡",
    "@fastkit/vue-click-outside": "å¤–å´ã‚¯ãƒªãƒƒã‚¯æ¤œçŸ¥",
    "@fastkit/vue-keyboard": "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ",
    "@fastkit/vue-resize": "ãƒªã‚µã‚¤ã‚ºç›£è¦–",
    "@fastkit/vue-transitions": "ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³æ©Ÿèƒ½",
    "@fastkit/vue-utils": "Vue.js ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£"
  },
  "peerDependencies": {
    "vue": "^3.5.0",
    "vue-router": "^4.4.0"
  }
}
```

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

<https://dadajam4.github.io/fastkit/vue-stack/>

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT
